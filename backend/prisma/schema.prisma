// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum Plan {
    Free
    Basic
    Premium
}

enum UserRole {
    Marketer
    Worker
}

enum UserStatus {
    Active
    Invited
    Disabled
}

enum BusinessStatus {
    Active
    Paused
    Archived
}

enum ProductType {
    Product
    Service
}

enum PriceSegment {
    Low
    Middle
    Premium
}

enum TagType {
    Niche
    Hashtag
    Pain
    Format
}

enum AIArtifactType {
    Idea
    Post
    Script
    Angle
}

enum AIArtifactStatus {
    Draft
    Approved
    Rejected
}





model Agency {
    id        String   @id @default(uuid())
    name      String
    plan      Plan
    createdAt DateTime @default(now())

    users     User[]
    businesses   Business[]
}

model Admin {
    id        String   @id @default(uuid())
    email     String   @unique
    name      String
    password  String
}

model User {
    id        String   @id @default(uuid())
    agencyId  String
    email     String   @unique
    name      String
    password  String
    role      UserRole
    status    UserStatus

    agency    Agency @relation(fields: [agencyId], references: [id])
}




model Business {
    id        String   @id @default(uuid())
    agencyId  String
    name      String
    website   String
    industry  String?
    status    BusinessStatus

    agency    Agency @relation(fields: [agencyId], references: [id])

    products  Product[]
    prompts   Prompt[]
    businessProfiles BusinessProfile[]
}


model BusinessProfile {
    id            String   @id @default(uuid())
    businessId    String
    name          String
    profileFocus  String
    isActive      Boolean  @default(true)
    createdAt     DateTime @default(now())

    business      Business @relation(fields: [businessId], references: [id])

    products      BusinessProfileProduct[]
    audiences     BusinessProfileTargetAudience[]
    platforms     BusinessProfilePlatform[]
    prompts       BusinessProfilePrompt[]

    tags          BusinessProfileTag[]
    trendMatches  BusinessTrendMatch[]
    aiArtifacts   AIArtifact[]
}

model Prompt {
    id           String   @id @default(uuid())
    businessId   String
    name         String
    purpose      String
    text         String
    isActive     Boolean  @default(true)
    createdAt    DateTime @default(now())

    profiles     BusinessProfilePrompt[]

    business     Business @relation(fields: [businessId], references: [id])
}

model Product {
    id             String   @id @default(uuid())
    businessId     String
    type           ProductType
    priceSegment   PriceSegment
    name           String
    description    String
    isActive       Boolean  @default(true)
    images         String[]
    embedding      Unsupported("vector(1536)")?

    profiles       BusinessProfileProduct[]
    aiArtifacts    AIArtifactProduct[]

    business       Business @relation(fields: [businessId], references: [id])
}

model TargetAudience {
    id               String   @id @default(uuid())
    businessId       String
    name             String
    ageRange         String
    gender           String?
    geo              String
    pains            String[]
    desires          String[]
    triggers         String[]
    incomeLevel      String?

    profiles         BusinessProfileTargetAudience[]
}

model Platform {
    id               String   @id @default(uuid())
    businessId       String
    code             String   @unique
    name             String
    trendRefreshRate Int
    supportedFormats String[]
    isActive         Boolean  @default(true)

    trends           Trend[]
    profiles         BusinessProfilePlatform[]
}

model AIArtifact {
    id               String   @id @default(uuid())
    type             AIArtifactType
    businessId        String
    businessProfileId String

    trendId          String?
    outputJson       Json
    score            Float?
    status           AIArtifactStatus
    createdAt        DateTime @default(now())

    products         AIArtifactProduct[]

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id])
    trend           Trend?          @relation(fields: [trendId], references: [id])

    @@index([businessId])
}



model Trend {
    id          String   @id @default(uuid())
    businessId       String

    platformId  String
    source      String
    title       String
    description String
    format      String
    keywords    String[]
    publishedAt DateTime
    metrics     Json?
    embedding   Unsupported("vector(1536)")?
    createdAt   DateTime @default(now())

    platform    Platform @relation(fields: [platformId], references: [id])
    matches     BusinessTrendMatch[]
    aiArtifacts AIArtifact[]
}


model Tag {
    id              String   @id @default(uuid())
    businessId       String
    type            TagType
    value           String
    normalizedValue String

    profiles        BusinessProfileTag[]
}






model AIArtifactProduct {
  aiArtifactId String
  productId    String

  aiArtifact AIArtifact @relation(fields: [aiArtifactId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  @@id([aiArtifactId, productId])
}


model BusinessProfileProduct {
    businessProfileId String
    productId         String

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, productId])
}

model BusinessProfileTargetAudience {
    businessProfileId String
    targetAudienceId String

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    targetAudience TargetAudience @relation(fields: [targetAudienceId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, targetAudienceId])
}

model BusinessProfilePrompt {
    businessProfileId String
    promptId          String

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    prompt Prompt @relation(fields: [promptId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, promptId])
}

model BusinessProfilePlatform {
    businessProfileId String
    platformId        String
    priority          Int
    notes             String?

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    platform Platform @relation(fields: [platformId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, platformId])
}

model BusinessProfileTag {
    businessProfileId String
    tagId             String
    weight            Float

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    tag Tag @relation(fields: [tagId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, tagId])
}

model BusinessTrendMatch {
    businessProfileId String
    trendId           String
    relevanceScore    Float
    matchedAt         DateTime @default(now())

    businessProfile BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
    trend Trend @relation(fields: [trendId], references: [id], onDelete: Cascade)

    @@id([businessProfileId, trendId])
}
